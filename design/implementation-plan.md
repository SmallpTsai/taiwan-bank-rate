# 台灣銀行匯率查詢 Library - 實作計畫

## 開發階段

### 第一階段：基礎架構 (1-2 天)

#### 1.1 專案初始化
- [ ] 建立 `package.json` 和 TypeScript 配置
- [ ] 設定專案結構和目錄
- [ ] 配置 ESLint 和 Prettier
- [ ] 建立基本的型別定義

#### 1.2 核心型別定義
- [ ] 實作 `types/rate.ts` - 匯率相關型別
- [ ] 實作 `types/index.ts` - 主要型別匯出
- [ ] 定義錯誤類別和配置介面

#### 1.3 工具函數
- [ ] 實作 `utils/date-utils.ts` - 日期處理工具
- [ ] 實作 `utils/currency-utils.ts` - 幣別處理工具
- [ ] 實作 `utils/index.ts` - 工具函數匯出

### 第二階段：核心功能 (2-3 天)

#### 2.1 HTTP 客戶端
- [ ] 實作 `client/http-client.ts` - HTTP 通訊層
- [ ] 實作重試機制和錯誤處理
- [ ] 實作超時控制和請求配置

#### 2.2 CSV 解析器
- [ ] 實作 `parser/csv-parser.ts` - CSV 解析邏輯
- [ ] 實作即時匯率資料解析
- [ ] 實作歷史匯率資料解析
- [ ] 實作資料驗證和錯誤處理

#### 2.3 主要客戶端類別
- [ ] 實作 `client/index.ts` - RateClient 主要類別
- [ ] 整合 HTTP 客戶端和解析器
- [ ] 實作配置管理和預設值

### 第三階段：API 整合 (1-2 天)

#### 3.1 即時匯率功能
- [ ] 實作 `getCurrentRates(currency?)` 方法
- [ ] 支援單一幣別或多個幣別查詢
- [ ] 實作 429 錯誤不重試的邏輯
- [ ] 測試與台灣銀行 API 的整合

#### 3.2 歷史匯率功能
- [ ] 實作 `getHistoricalRates(currency, startDate, endDate)` 方法
- [ ] 實作日期範圍生成和驗證
- [ ] 實作 429 錯誤內部重試機制
- [ ] 測試歷史資料解析和日期過濾

#### 3.3 主要匯出點
- [ ] 實作 `src/index.ts` - 主要匯出點
- [ ] 設定預設匯出和命名匯出

### 第四階段：測試和文件 (2-3 天)

#### 4.1 單元測試
- [ ] 為每個模組撰寫單元測試
- [ ] 測試錯誤處理和邊界情況
- [ ] 測試配置和驗證邏輯

#### 4.2 整合測試
- [ ] 測試與真實 API 的整合
- [ ] 測試重試機制和錯誤恢復
- [ ] 測試各種幣別和日期範圍

#### 4.3 文件撰寫
- [ ] 撰寫 README.md 使用說明
- [ ] 撰寫 API 文件
- [ ] 撰寫範例程式碼

### 第五階段：優化和發布 (1 天)

#### 5.1 效能優化
- [ ] 優化 CSV 解析效能
- [ ] 實作記憶體使用優化
- [ ] 檢查並修復記憶體洩漏

#### 5.2 發布準備
- [ ] 建立 `.npmignore` 檔案
- [ ] 設定 TypeScript 編譯配置
- [ ] 準備發布到 npm

## 實作順序

### 優先級 1：核心功能
1. **型別定義** - 建立所有必要的 TypeScript 介面
2. **HTTP 客戶端** - 實作基本的 HTTP 通訊功能
3. **CSV 解析器** - 實作 CSV 資料解析邏輯
4. **主要客戶端** - 整合所有功能到 RateClient 類別

### 優先級 2：API 方法
1. **即時匯率** - 實作 `getCurrentRates(currency?)` 支援單一或多個幣別
2. **歷史匯率** - 實作 `getHistoricalRates(currency, startDate, endDate)` 支援日期範圍
3. **錯誤處理** - 實作不同 API 的不同重試策略

### 優先級 3：品質保證
1. **單元測試** - 為所有模組撰寫測試
2. **整合測試** - 測試與真實 API 的整合
3. **文件** - 撰寫完整的使用文件

## 技術決策

### 1. 依賴管理
- **HTTP 客戶端**: 使用 Node.js 內建的 `fetch` API
- **CSV 解析**: 自製輕量級解析器，避免外部依賴
- **型別安全**: 完整的 TypeScript 支援

### 2. 錯誤處理策略
- **即時匯率**: 遇到 429 錯誤不重試，交由外部處理
- **歷史匯率**: 遇到 429 錯誤在內部重試，使用指數退避
- **錯誤分類**: 網路錯誤、API 錯誤、解析錯誤
- **錯誤訊息**: 提供詳細的中文錯誤訊息

### 3. 效能考量
- **記憶體使用**: 避免大量資料載入記憶體
- **網路請求**: 實作請求限流和快取機制
- **解析效能**: 優化 CSV 解析演算法

## 風險評估

### 高風險項目
1. **API 變更**: 台灣銀行可能變更 API 格式
   - 緩解：實作版本檢查和向後相容性

2. **請求限制**: API 可能有嚴格的請求頻率限制
   - 緩解：實作請求限流和重試機制

3. **資料格式**: CSV 格式可能不穩定
   - 緩解：實作強健的解析器和錯誤處理

### 中風險項目
1. **網路穩定性**: 網路連線可能不穩定
   - 緩解：實作重試機制和超時控制

2. **時區問題**: 日期和時間處理可能有時區問題
   - 緩解：使用 UTC 時間並提供時區轉換工具

## 成功標準

### 功能完整性
- [ ] 能夠取得所有支援幣別的即時匯率
- [ ] 能夠取得指定幣別的歷史匯率
- [ ] 提供現金買入/賣出、即期買入/賣出四個關鍵數據

### 可靠性
- [ ] 處理網路錯誤和 API 錯誤
- [ ] 實作重試機制和錯誤恢復
- [ ] 提供清晰的錯誤訊息

### 易用性
- [ ] 提供簡潔的 API 介面
- [ ] 完整的 TypeScript 支援
- [ ] 詳細的使用文件和範例

### 效能
- [ ] 請求回應時間 < 5 秒
- [ ] 記憶體使用量 < 50MB
- [ ] 支援並發請求

## 後續規劃

### 版本 1.1
- [ ] 實作快取機制
- [ ] 支援更多幣別
- [ ] 提供匯率趨勢分析功能

### 版本 1.2
- [ ] 實作 WebSocket 即時更新
- [ ] 提供匯率通知功能
- [ ] 支援自訂資料來源

### 版本 2.0
- [ ] 支援多個匯率來源
- [ ] 提供匯率比較功能
- [ ] 實作進階分析工具 